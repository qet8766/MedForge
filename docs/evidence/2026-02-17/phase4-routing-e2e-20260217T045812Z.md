## Phase 4 Routing and End-to-End Evidence (2026-02-17)

Generated by: `ops/host/validate-phase4-routing-e2e.sh`

Runtime:
- phase id: `phase4-routing-e2e`
- run id: `20260217T045812Z`
- API URL: `http://127.0.0.1:8000`
- Request API URL: `http://127.0.0.1:8000`
- Pack image: `medforge-pack-default:local@sha256:7e44d4e67aa5c7bbc51701be7f370f45de35794cc7f2504f761b1a510f1c1a6e`
- DB path: `/home/shk/projects/MedForge/apps/api/phase4-evidence.db`
- Core-only mode: `false`
- Browser lane enabled: `false`

### Create Sessions

- create A: `{"data":{"message":"Session started.","session":{"id":"eeb20d99-2312-460a-8399-0190967b32f0","user_id":"33a2a1d2-b8db-46a3-8574-b0265b644936","tier":"public","pack_id":"00000000-0000-0000-0000-000000000100","status":"running","container_id":"d9d3b557960519f772422c259bfc564b38bcac3514d795943bcc109f0e333199","gpu_id":0,"slug":"lmereqad","workspace_zfs":"tank/medforge/workspaces/33a2a1d2-b8db-46a3-8574-b0265b644936/eeb20d99-2312-460a-8399-0190967b32f0","created_at":"2026-02-17T04:58:15.100535","started_at":"2026-02-17T04:58:15.742437","stopped_at":null,"error_message":null}},"meta":{"request_id":"227f3594-bea5-4142-89f8-14753d2cd1e1","api_version":"v1.0","timestamp":"2026-02-17T04:58:15.750056Z","limit":null,"next_cursor":null,"has_more":null}}`
- create B: `{"data":{"message":"Session started.","session":{"id":"6d377b20-f1bf-4026-83d5-475cf195097f","user_id":"1127333c-6a43-4b56-bc6b-cdc02909c078","tier":"public","pack_id":"00000000-0000-0000-0000-000000000100","status":"running","container_id":"122ca814f54bbb6388363041e8bfce5b6491a4c28aa22bc790efe41ed6923a0c","gpu_id":1,"slug":"tqki2gic","workspace_zfs":"tank/medforge/workspaces/1127333c-6a43-4b56-bc6b-cdc02909c078/6d377b20-f1bf-4026-83d5-475cf195097f","created_at":"2026-02-17T04:58:15.844490","started_at":"2026-02-17T04:58:16.488328","stopped_at":null,"error_message":null}},"meta":{"request_id":"245cc8e4-ca4d-4087-bad7-ed9dc18e47ee","api_version":"v1.0","timestamp":"2026-02-17T04:58:16.500871Z","limit":null,"next_cursor":null,"has_more":null}}`

### Routing Authorization Matrix

- unauthenticated: `401` body=`{"type":"https://medforge.dev/problems/http/401","title":"Unauthorized","status":401,"detail":"Authentication required.","instance":"/api/v1/auth/session-proxy","code":"401","request_id":"42ff3db4-c982-4ea5-a970-e2f48925f07a"}`
- non-owner: `403` body=`{"type":"https://medforge.dev/problems/http/403","title":"Forbidden","status":403,"detail":"Session access denied.","instance":"/api/v1/auth/session-proxy","code":"403","request_id":"171569c4-1a98-49a6-abbe-309d122f2342"}`
- owner spoof attempt: `200` x-upstream=`mf-session-lmereqad:8080`

### East-West Isolation

- firewall: `Eastâ€“west isolation applied (bridge=br-55088beacfcf, caddy=172.30.0.2)`
- session B -> session A :8080 blocked (exit=`28`, stderr=`curl: (28) Connection timed out after 3002 milliseconds`)

### End-to-End Core Runtime

- GPU in session A: `NVIDIA GeForce RTX 5090`
- workspace write/read: `alpha`
- stop A: `{"data":{"message":"Session stop requested."},"meta":{"request_id":"e90085ed-5569-4d06-acb5-08375cc47124","api_version":"v1.0","timestamp":"2026-02-17T04:58:20.033847Z","limit":null,"next_cursor":null,"has_more":null}}`
- stopped host check: `404` body=`{"type":"https://medforge.dev/problems/http/404","title":"Not Found","status":404,"detail":"Session not found.","instance":"/api/v1/auth/session-proxy","code":"404","request_id":"57124d5d-0ae1-459a-8ac5-1e21cff6fd76"}`
- snapshot: `tank/medforge/workspaces/33a2a1d2-b8db-46a3-8574-b0265b644936/eeb20d99-2312-460a-8399-0190967b32f0@stop-1771304304293`
- stop B: `{"data":{"message":"Session stop requested."},"meta":{"request_id":"e4635605-7422-4f8e-b73b-226fbf09bca4","api_version":"v1.0","timestamp":"2026-02-17T04:58:25.203098Z","limit":null,"next_cursor":null,"has_more":null}}`

### Residual Gaps

- Caddy wildcard websocket validation is not covered by this script.
- Full browser UI flow validation is not covered by this script.

### API Log Snippet

```text
INFO:     Started server process [341879]
INFO:     Waiting for application startup.
INFO  [alembic.runtime.migration] Context impl SQLiteImpl.
INFO  [alembic.runtime.migration] Will assume non-transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade  -> 2474ec93cdb5, initial_schema
INFO  [alembic.runtime.migration] Running upgrade 2474ec93cdb5 -> a1b2c3d4e5f6, drop_gpu_active
2026-02-17 13:58:15 [info     ] session.start                  gpu_id=0 pack_id=00000000-0000-0000-0000-000000000100 request_id=227f3594-bea5-4142-89f8-14753d2cd1e1 session_id=eeb20d99-2312-460a-8399-0190967b32f0 slug=lmereqad tier=PUBLIC user_id=33a2a1d2-b8db-46a3-8574-b0265b644936
2026-02-17 13:58:16 [info     ] session.start                  gpu_id=1 pack_id=00000000-0000-0000-0000-000000000100 request_id=245cc8e4-ca4d-4087-bad7-ed9dc18e47ee session_id=6d377b20-f1bf-4026-83d5-475cf195097f slug=tqki2gic tier=PUBLIC user_id=1127333c-6a43-4b56-bc6b-cdc02909c078
2026-02-17 13:58:18 [info     ] session.recovery.decision      container_id=d9d3b557960519f772422c259bfc564b38bcac3514d795943bcc109f0e333199 correlation_id=616ae952-fd04-4edf-abd0-76b9d0185f04 recovery_mode=poll session_id=eeb20d99-2312-460a-8399-0190967b32f0 slug=lmereqad state=running user_id=33a2a1d2-b8db-46a3-8574-b0265b644936
2026-02-17 13:58:18 [info     ] session.recovery.decision      container_id=122ca814f54bbb6388363041e8bfce5b6491a4c28aa22bc790efe41ed6923a0c correlation_id=616ae952-fd04-4edf-abd0-76b9d0185f04 recovery_mode=poll session_id=6d377b20-f1bf-4026-83d5-475cf195097f slug=tqki2gic state=running user_id=1127333c-6a43-4b56-bc6b-cdc02909c078
2026-02-17 13:58:24 [info     ] session.stop                   correlation_id=70e36437-3a3b-47d7-8608-2882f73c1a8c gpu_id=0 pack_id=00000000-0000-0000-0000-000000000100 reason=requested recovery_mode=poll session_id=eeb20d99-2312-460a-8399-0190967b32f0 slug=lmereqad tier=PUBLIC user_id=33a2a1d2-b8db-46a3-8574-b0265b644936
2026-02-17 13:58:24 [info     ] session.recovery.decision      container_id=122ca814f54bbb6388363041e8bfce5b6491a4c28aa22bc790efe41ed6923a0c correlation_id=70e36437-3a3b-47d7-8608-2882f73c1a8c recovery_mode=poll session_id=6d377b20-f1bf-4026-83d5-475cf195097f slug=tqki2gic state=running user_id=1127333c-6a43-4b56-bc6b-cdc02909c078
2026-02-17 13:58:24 [info     ] session.poll.updated           correlation_id=70e36437-3a3b-47d7-8608-2882f73c1a8c recovery_mode=poll updated=1
2026-02-17 13:58:29 [info     ] session.stop                   correlation_id=7cd4211b-816b-432c-9273-574ba5adc4a8 gpu_id=1 pack_id=00000000-0000-0000-0000-000000000100 reason=requested recovery_mode=poll session_id=6d377b20-f1bf-4026-83d5-475cf195097f slug=tqki2gic tier=PUBLIC user_id=1127333c-6a43-4b56-bc6b-cdc02909c078
2026-02-17 13:58:29 [info     ] session.poll.updated           correlation_id=7cd4211b-816b-432c-9273-574ba5adc4a8 recovery_mode=poll updated=1
```
