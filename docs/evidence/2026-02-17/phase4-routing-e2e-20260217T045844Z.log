
### Create Sessions

- create A: `{"data":{"message":"Session started.","session":{"id":"f34509a9-75e5-4d7c-8b60-8b8b697a4e71","user_id":"9a6e8ad6-7a6f-4f66-88a1-6f17907d24f6","exposure":"external","pack_id":"00000000-0000-0000-0000-000000000100","status":"running","container_id":"f7c46920586f602dd2e4eddcbb3bf6aab9c79b296e6041e8a7e7a432c0c33d72","gpu_id":0,"slug":"ypswruiy","workspace_zfs":"tank/medforge/workspaces/9a6e8ad6-7a6f-4f66-88a1-6f17907d24f6/f34509a9-75e5-4d7c-8b60-8b8b697a4e71","created_at":"2026-02-17T04:58:47.803504","started_at":"2026-02-17T04:58:48.446866","stopped_at":null,"error_message":null}},"meta":{"request_id":"53e626f9-69b0-4b30-b22f-00a1f2030586","api_version":"v1.0","timestamp":"2026-02-17T04:58:48.454224Z","limit":null,"next_cursor":null,"has_more":null}}`
- create B: `{"data":{"message":"Session started.","session":{"id":"ebfb1d86-cc35-4b50-bd00-b6f86411241a","user_id":"ee610994-0df6-4f62-bff8-965116170713","exposure":"external","pack_id":"00000000-0000-0000-0000-000000000100","status":"running","container_id":"010f0e29474ffa3de18fea4bb7921976577f81b93a9727c572a7b63fa4c47638","gpu_id":1,"slug":"xt2dbnoe","workspace_zfs":"tank/medforge/workspaces/ee610994-0df6-4f62-bff8-965116170713/ebfb1d86-cc35-4b50-bd00-b6f86411241a","created_at":"2026-02-17T04:58:48.544858","started_at":"2026-02-17T04:58:49.207530","stopped_at":null,"error_message":null}},"meta":{"request_id":"b42ebab9-978c-4bd7-b1fa-562709de4e04","api_version":"v1.0","timestamp":"2026-02-17T04:58:49.214984Z","limit":null,"next_cursor":null,"has_more":null}}`

### Routing Authorization Matrix

- unauthenticated: `401` body=`{"type":"https://medforge.dev/problems/http/401","title":"Unauthorized","status":401,"detail":"Authentication required.","instance":"/api/v1/auth/session-proxy","code":"401","request_id":"ffa3f665-11ff-4b4c-93e4-67c1ad163a9e"}`
- non-owner: `403` body=`{"type":"https://medforge.dev/problems/http/403","title":"Forbidden","status":403,"detail":"Session access denied.","instance":"/api/v1/auth/session-proxy","code":"403","request_id":"851c28d2-85e1-45d5-ac71-bf343d7bcbb7"}`
- owner spoof attempt: `200` x-upstream=`mf-session-ypswruiy:8080`

### East-West Isolation

- firewall: `Eastâ€“west isolation applied (bridge=br-55088beacfcf, caddy=172.30.0.2)`
- session B -> session A :8080 blocked (exit=`28`, stderr=`curl: (28) Connection timed out after 3002 milliseconds`)

### End-to-End Core Runtime

- GPU in session A: `NVIDIA GeForce RTX 5090`
- workspace write/read: `alpha`
- stop A: `{"data":{"message":"Session stop requested."},"meta":{"request_id":"2a16b6c8-b75b-44a5-b710-f55cd0822f19","api_version":"v1.0","timestamp":"2026-02-17T04:58:52.803016Z","limit":null,"next_cursor":null,"has_more":null}}`
- stopped host check: `404` body=`{"type":"https://medforge.dev/problems/http/404","title":"Not Found","status":404,"detail":"Session not found.","instance":"/api/v1/auth/session-proxy","code":"404","request_id":"898d7bf9-d25e-4dac-a35d-a5b8d7d07f13"}`
- snapshot: `tank/medforge/workspaces/9a6e8ad6-7a6f-4f66-88a1-6f17907d24f6/f34509a9-75e5-4d7c-8b60-8b8b697a4e71@stop-1771304337022`
- stop B: `{"data":{"message":"Session stop requested."},"meta":{"request_id":"db1eae92-bdeb-477a-a7c5-b0e28d517576","api_version":"v1.0","timestamp":"2026-02-17T04:58:57.978491Z","limit":null,"next_cursor":null,"has_more":null}}`

### Residual Gaps

- Caddy wildcard websocket validation is not covered by this script.
- Full browser UI flow validation is not covered by this script.

### API Log Snippet

```text
INFO:     Started server process [343015]
INFO:     Waiting for application startup.
INFO  [alembic.runtime.migration] Context impl SQLiteImpl.
INFO  [alembic.runtime.migration] Will assume non-transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade  -> 2474ec93cdb5, initial_schema
INFO  [alembic.runtime.migration] Running upgrade 2474ec93cdb5 -> a1b2c3d4e5f6, drop_gpu_active
2026-02-17 13:58:48 [info     ] session.start                  gpu_id=0 pack_id=00000000-0000-0000-0000-000000000100 request_id=53e626f9-69b0-4b30-b22f-00a1f2030586 session_id=f34509a9-75e5-4d7c-8b60-8b8b697a4e71 slug=ypswruiy exposure=EXTERNAL user_id=9a6e8ad6-7a6f-4f66-88a1-6f17907d24f6
2026-02-17 13:58:49 [info     ] session.start                  gpu_id=1 pack_id=00000000-0000-0000-0000-000000000100 request_id=b42ebab9-978c-4bd7-b1fa-562709de4e04 session_id=ebfb1d86-cc35-4b50-bd00-b6f86411241a slug=xt2dbnoe exposure=EXTERNAL user_id=ee610994-0df6-4f62-bff8-965116170713
2026-02-17 13:58:51 [info     ] session.recovery.decision      container_id=f7c46920586f602dd2e4eddcbb3bf6aab9c79b296e6041e8a7e7a432c0c33d72 correlation_id=fba13ae8-021c-4dd7-a446-80f0b029c2ab recovery_mode=poll session_id=f34509a9-75e5-4d7c-8b60-8b8b697a4e71 slug=ypswruiy state=running user_id=9a6e8ad6-7a6f-4f66-88a1-6f17907d24f6
2026-02-17 13:58:51 [info     ] session.recovery.decision      container_id=010f0e29474ffa3de18fea4bb7921976577f81b93a9727c572a7b63fa4c47638 correlation_id=fba13ae8-021c-4dd7-a446-80f0b029c2ab recovery_mode=poll session_id=ebfb1d86-cc35-4b50-bd00-b6f86411241a slug=xt2dbnoe state=running user_id=ee610994-0df6-4f62-bff8-965116170713
2026-02-17 13:58:57 [info     ] session.stop                   correlation_id=03d9d58b-6fe7-4c1d-9599-62772544cb59 gpu_id=0 pack_id=00000000-0000-0000-0000-000000000100 reason=requested recovery_mode=poll session_id=f34509a9-75e5-4d7c-8b60-8b8b697a4e71 slug=ypswruiy exposure=EXTERNAL user_id=9a6e8ad6-7a6f-4f66-88a1-6f17907d24f6
2026-02-17 13:58:57 [info     ] session.recovery.decision      container_id=010f0e29474ffa3de18fea4bb7921976577f81b93a9727c572a7b63fa4c47638 correlation_id=03d9d58b-6fe7-4c1d-9599-62772544cb59 recovery_mode=poll session_id=ebfb1d86-cc35-4b50-bd00-b6f86411241a slug=xt2dbnoe state=running user_id=ee610994-0df6-4f62-bff8-965116170713
2026-02-17 13:58:57 [info     ] session.poll.updated           correlation_id=03d9d58b-6fe7-4c1d-9599-62772544cb59 recovery_mode=poll updated=1
2026-02-17 13:59:02 [info     ] session.stop                   correlation_id=d65138dd-ee08-4bed-8f36-e203a21dd132 gpu_id=1 pack_id=00000000-0000-0000-0000-000000000100 reason=requested recovery_mode=poll session_id=ebfb1d86-cc35-4b50-bd00-b6f86411241a slug=xt2dbnoe exposure=EXTERNAL user_id=ee610994-0df6-4f62-bff8-965116170713
2026-02-17 13:59:02 [info     ] session.poll.updated           correlation_id=d65138dd-ee08-4bed-8f36-e203a21dd132 recovery_mode=poll updated=1
```

Validation complete: /home/shk/projects/MedForge/docs/evidence/2026-02-17/phase4-routing-e2e-20260217T045844Z.md
